# Pi Identity Linking with sQuid

## Overview

Guide for linking Pi Network identities with sQuid for unified authentication and permission management.

## Prerequisites

- Valid Pi Network identity
- Configured sQuid instance
- Access to Pi Browser or Pi SDK

## Linking Process

### 1. Prepare Credentials

```javascript
// Get Pi credentials from user
const piCredentials = {
  piUserId: 'pi_user_123',
  accessToken: 'pi_access_token_xyz',
  publicKey: '0x...',
  signature: '0x...'
};

// Prepare sQuid identity
const squidId = 'squid_abc_456';
```

### 2. Execute Linking

```javascript
import { PiIntegrationLayer } from '@anarq/pi-integration';

const piIntegration = new PiIntegrationLayer();
await piIntegration.initialize();

// Link identities
const linkingResult = await piIntegration.linkPiIdentity(
  squidId,
  piCredentials.piUserId,
  {
    verificationMethod: 'signature',
    expiresIn: '30d'
  }
);

if (linkingResult.success) {
  console.log('Linking successful:', linkingResult.bindingId);
  console.log('Binding hash:', linkingResult.bindingHash);
  console.log('Expires at:', linkingResult.expiresAt);
}
```

### 3. Verify Linking

```javascript
// Verify linking status
const binding = await piIntegration.getIdentityBinding(squidId);

if (binding && binding.status === 'VERIFIED') {
  console.log('Identity verified:', {
    squidId: binding.squidId,
    piUserId: binding.piUserId,
    verificationMethod: binding.verificationMethod,
    bindingHash: binding.metadata.bindingHash
  });
}
```

## Verification Methods

### Signature Verification

```javascript
// Generate binding proof with signature
const bindingProof = await piIntegration.generateIdentityBindingProof(
  squidId,
  piUserId,
  'signature'
);

console.log('Binding proof:', {
  method: bindingProof.method,
  signature: bindingProof.signature,
  timestamp: bindingProof.timestamp,
  nonce: bindingProof.nonce
});
```

### Token Verification

```javascript
// Verification using Pi token
const tokenProof = await piIntegration.generateIdentityBindingProof(
  squidId,
  piUserId,
  'token'
);
```

## Permission Management

### Configure Qonsent Scopes

```javascript
// Define permissions for linked identity
const qonsentScopes = [
  'qwallet:read',
  'qwallet:transaction',
  'qindex:read',
  'qerberos:audit'
];

await piIntegration.configureQonsentScopes(
  bindingId,
  qonsentScopes
);
```

### Validate Permissions

```javascript
// Verify permissions before operations
const hasPermission = await piIntegration.validateQonsentScope(
  bindingId,
  'qwallet:transaction'
);

if (hasPermission) {
  // Proceed with transaction
  await executeTransaction();
}
```

## Renewal and Expiration

### Renew Linking

```javascript
// Renew linking before expiration
const renewalResult = await piIntegration.renewIdentityBinding(
  bindingId,
  {
    expiresIn: '60d',
    updateVerification: true
  }
);

if (renewalResult.success) {
  console.log('Linking renewed until:', renewalResult.newExpiresAt);
}
```

### Handle Expiration

```javascript
// Check expiration status
const expirationStatus = await piIntegration.checkBindingExpiration(bindingId);

if (expirationStatus.isExpired) {
  console.log('Binding expired, renewal required');
  
  // Notify user
  await notifyUserOfExpiration(squidId, expirationStatus.expiredAt);
}
```

## Security

### Best Practices

1. **Key Rotation**
   - Rotate binding keys regularly
   - Use appropriate expiration periods

2. **Signature Validation**
   - Verify all signatures before processing
   - Use nonces to prevent replay attacks

3. **Auditing**
   - Log all linking operations
   - Monitor failed linking attempts

### Security Configuration

```javascript
// Configure security parameters
const securityConfig = {
  maxBindingAttempts: 3,
  bindingCooldown: '5m',
  signatureAlgorithm: 'ed25519',
  nonceExpiration: '10m',
  auditLevel: 'full'
};

await piIntegration.configureBindingSecurity(securityConfig);
```

---

*Last Updated: 2025-08-31T09:42:47.562Z*  
*Generated by: DocumentationGenerator v1.0.0*
