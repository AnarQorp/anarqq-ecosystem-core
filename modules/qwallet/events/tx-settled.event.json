{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.anarq.com/qwallet/events/tx-settled.json",
  "title": "Transaction Settled Event",
  "description": "Event published when a transaction is successfully settled on blockchain",
  "type": "object",
  "properties": {
    "topic": {
      "type": "string",
      "const": "q.qwallet.tx.settled.v1"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "actor": {
      "$ref": "https://schemas.anarq.com/common/identity-ref.json"
    },
    "data": {
      "type": "object",
      "properties": {
        "transactionId": {
          "type": "string",
          "pattern": "^tx_[a-f0-9]{32}$"
        },
        "blockchainHash": {
          "type": "string",
          "description": "Blockchain transaction hash"
        },
        "blockNumber": {
          "type": "integer",
          "minimum": 0
        },
        "blockHash": {
          "type": "string"
        },
        "gasUsed": {
          "type": "integer",
          "minimum": 0
        },
        "gasPrice": {
          "type": "string"
        },
        "finalAmount": {
          "type": "number",
          "minimum": 0
        },
        "fees": {
          "type": "object",
          "properties": {
            "network": {
              "type": "number",
              "minimum": 0
            },
            "platform": {
              "type": "number",
              "minimum": 0
            },
            "total": {
              "type": "number",
              "minimum": 0
            }
          },
          "required": ["network", "platform", "total"]
        },
        "network": {
          "type": "string"
        },
        "confirmations": {
          "type": "integer",
          "minimum": 0
        }
      },
      "required": [
        "transactionId",
        "blockchainHash",
        "blockNumber",
        "gasUsed",
        "finalAmount",
        "fees",
        "network"
      ]
    },
    "signature": {
      "$ref": "https://schemas.anarq.com/common/lock-sig.json"
    },
    "cid": {
      "type": "string",
      "description": "IPFS content identifier for event data"
    }
  },
  "required": ["topic", "timestamp", "actor", "data", "signature"],
  "additionalProperties": false
}